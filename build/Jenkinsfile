stage "unit test"

stage name: 'instanciate a target VM', concurrency: 1
parallel('vm-ubuntu': {
  node {
    echo 'instanciate vm-ubuntu'
    // sh 'ssh -tt $APPFLOW_DH_USERNAME@$APPFLOW_DH_HOSTIP zsh --login -c "\'cd ~/appflow ; vagrant status testing ; vagrant halt testing ; vagrant destroy -f testing ; export ANSIBLE_TAGS=$TAGS ; export ANSIBLE_TAGS_SKIP=$SKIP_TAGS ; vagrant up testing\'"'
    // sh 'eval $(ssh-agent) ; ssh-add ~/.ssh/id_rsa* ; ssh -tt $APPFLOW_DH_USERNAME@$APPFLOW_DH_HOSTIP zsh --login -c "\'cli -e \""vm template show\""\'"'

    sh """
      eval $(ssh-agent)
      ssh-add ~/.ssh/id_rsa*
    """
  }
// }, 'vm-centos': {
//   node {
//     echo 'instanciate vm-centos'
//     sh 'ssh -tt $APPFLOW_DH_USERNAME@$APPFLOW_DH_HOSTIP zsh --login -c "\'cd ~/appflow ; vagrant status testing.centos ; vagrant halt testing.centos ; vagrant destroy -f testing.centos ; export ANSIBLE_TAGS=$TAGS ; export ANSIBLE_TAGS_SKIP=$SKIP_TAGS ; vagrant up testing.centos\'"'
//   }
// }, 'vm-macos': {
//   node {
//     echo 'instanciate vm-macos'
//     sh 'echo "do something"'
//   }
})
